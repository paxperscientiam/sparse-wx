{"code":"//     Copyright (C) 2018 Christopher David Ramos\r\nimport { fetch, push as pushy } from \"~Data/PushPull\";\r\nimport { HTTP, } from \"~Data/Dictionary\";\r\nimport { _Cache } from \"~Handlers/Aux\";\r\nimport dlv from \"@paxperscientiam/dlv.ts\";\r\nimport { JsonResponseHandler } from \"~Handlers/JsonResponse\";\r\nimport { NWSUrlService } from \"~Handlers/nwsUrlHandlers\";\r\nimport { timeConversion, timeStamp } from \"~Utilities/Date\";\r\nfunction nwsMetaLocationData() {\r\n    //  const WX = PROPS.WX\r\n    const lat = Number(fetch(\"user\", \"lat\")).toFixed(4);\r\n    const lon = Number(fetch(\"user\", \"lon\")).toFixed(4);\r\n    const coord = `${lat},${lon}`;\r\n    Logger.log(`[${timeStamp()}][coord] ${coord}`);\r\n    const urlForMeta = NWSUrlService.getMetaLink(coord);\r\n    Logger.log(`[${timeStamp()}][urlForMeta] ${urlForMeta}`);\r\n    const params = HTTP.WX_SERVICE.PARAMS;\r\n    const preWxRaw = JsonResponseHandler(urlForMeta, {}, params);\r\n    const wxRaw = _Cache(preWxRaw.fetch.bind(preWxRaw), [\"\"], \"wxRaw\", 0);\r\n    return wxRaw.getResult();\r\n}\r\nexport function getWeatherServiceDataService() {\r\n    const obj = Object.create({});\r\n    const wxResponse = nwsMetaLocationData();\r\n    obj.status = [];\r\n    obj.push(wxResponse.cacheStatus);\r\n    if (wxResponse.cacheData != null) {\r\n        pushy([\"state\", \"cache.wx.meta\"], \"not found\");\r\n        obj.status.push([true, \"metadata result found in cache\"]);\r\n    }\r\n    else {\r\n        pushy([\"state\", \"cache.wx.meta\"], \"found\");\r\n        obj.status.push([false, \"metadata not found in cache!\"]);\r\n        return obj;\r\n    }\r\n    if (dlv(wxResponse, \"cacheData.data.properties\") == null) {\r\n        pushy([\"state\", \"cache.wx.meta.properties\"], \"meta\");\r\n        Logger.log(\"wxResponse does not contain wx properties\");\r\n        obj.status.push([false, \"wxUrl fail\"]);\r\n        return obj;\r\n    }\r\n    const timeZone = dlv(wxResponse, \".data.properties.timeZone\");\r\n    pushy([\"wx\", \"timeZone\"], timeZone);\r\n    const wxUrl = dlv(wxResponse, \"cacheData.data.properties.forecast\");\r\n    if (wxUrl != null) {\r\n        pushy([\"state\", \"service.wx.meta.forecastUrl\"], wxUrl);\r\n        obj.status.push([true, `wxUrl: ${wxUrl}`]);\r\n    }\r\n    else {\r\n        pushy([\"state\", \"service.wx.meta.forecastUrl\"], undefined);\r\n        obj.status.push([false, \"wxUrl is undefined!\"]);\r\n        return obj;\r\n    }\r\n    const params = HTTP.WX_SERVICE.PARAMS;\r\n    const preWxRaw = JsonResponseHandler(wxUrl, {}, params);\r\n    const fetchResponse = _Cache(preWxRaw.fetch.bind(preWxRaw), [\"\"], \"wxRawForecast\", 0).getResult();\r\n    if (fetchResponse.cacheStatus != null) {\r\n        pushy([\"state\", \"cache.wx\"], \"cached\");\r\n        Logger.log(`wx dump response found in cache`);\r\n        obj.status.push([true, `wx dump response found in cache`]);\r\n    }\r\n    else {\r\n        pushy([\"state\", \"cache.wx\"], \"not cached\");\r\n        Logger.log(\"wx dump NOT found in cache!\");\r\n        obj.status.push([false, \"wx dump NOT found in cache!\"]);\r\n        return obj;\r\n    }\r\n    obj.wx = dlv(fetchResponse, \"cacheData.data\");\r\n    //  obj.timeZone = wx.properties.timeZone\r\n    if (dlv(obj, \"wx.properties\") == null) {\r\n        obj.status.push([false, \"mo wx data from site!\"]);\r\n        return obj;\r\n    }\r\n    obj.updateTime = dlv(obj.wx, \"properties.updateTime\");\r\n    pushy([\"wx\", \"updateTime\"], obj.updateTime);\r\n    obj.elevation = dlv(obj.wx, \"properties.elevation\");\r\n    pushy([\"wx\", \"elevation\"], obj.elevation);\r\n    const wxPeriodCounts = dlv(obj.wx, \"properties.periods\");\r\n    if (!!wxPeriodCounts) {\r\n        obj.wxPeriodCount = wxPeriodCounts.length;\r\n    }\r\n    obj.getPeriod = (period) => {\r\n        const periodic = obj.wx.properties.periods[period];\r\n        pushy([\"state\", \"display.wx.data.period\"], period);\r\n        const response = {\r\n            condition: periodic.shortForecast.toLowerCase(),\r\n            status: [true, \"wx is good\"],\r\n            iconUrl: periodic.icon,\r\n            isDaytime: periodic.isDaytime,\r\n            name: periodic.name,\r\n            temp: periodic.temperature,\r\n            unit: periodic.temperatureUnit,\r\n            windDirection: periodic.windDirection,\r\n            windSpeed: periodic.windSpeed,\r\n            cwa: obj.wx.properties.cwa,\r\n            cwaUrl: \"https://www.weather.gov/\",\r\n            updateTime: obj.wx.properties.updateTime,\r\n        };\r\n        return response;\r\n    };\r\n    return obj;\r\n}\r\nexport function checkWeatherServiceStatus() {\r\n    const urlWxServiceCheck = NWSUrlService.uri.base;\r\n    const params = HTTP.WX_SERVICE.PARAMS;\r\n    let result;\r\n    try {\r\n        result = JsonResponseHandler(urlWxServiceCheck, {}, params).fetch();\r\n    }\r\n    catch (e) {\r\n        pushy([\"state\", \"status.wx\"], \"ERR\");\r\n        Logger.log(`checkWeatherServiceStatus: ${e}`);\r\n        return \"ERR\";\r\n    }\r\n    Logger.log(`[${timeStamp()}][wxServiceStatus] ${result.data.status}`);\r\n    const status = dlv(result, \"data.status\");\r\n    pushy([\"state\", \"status.wx\"], status);\r\n    return status;\r\n}\r\nexport function getForecastStalenessService() {\r\n    const lastUpdateTime = fetch(\"wx\", \"updateTime\");\r\n    let diff;\r\n    if (!!lastUpdateTime) {\r\n        diff = Date.now() - (new Date(lastUpdateTime)).getTime();\r\n        diff = timeConversion(diff);\r\n        pushy([\"wx\", \"forecastAge\"], diff);\r\n        return [true, diff];\r\n    }\r\n    return [false, \"unknown\"];\r\n}\r\nexport function getAlertsByStateService() {\r\n    const params = HTTP.WX_SERVICE.PARAMS;\r\n    const userstate = fetch(\"user\", \"state\");\r\n    const urlWxAlerts = `https://api.weather.gov/alerts/active/count`;\r\n    let response;\r\n    let count;\r\n    if (!!userstate) {\r\n        response = JsonResponseHandler(urlWxAlerts, {}, params).fetch().data;\r\n        count = (response.areas[userstate]);\r\n        if (count != null) {\r\n            count = count.toFixed(0);\r\n            pushy([\"state\", \"service.wx.alerts\"], true);\r\n            return [true, count];\r\n        }\r\n        pushy([\"state\", \"service.wx.alerts\"], false);\r\n        return [false, \"0 alerts\"];\r\n    }\r\n    pushy([\"state\", \"service.wx.alerts\"], \"ERR\");\r\n    return [false, \"ERR\"];\r\n}\r\n//# sourceMappingURL=Weather.js.map","map":"{\"version\":3,\"file\":\"Weather.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/Services/Weather.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/ramos/Development/gmail-weather/Services/Weather.d.ts","writeByteOrderMark":false,"text":"export declare function getWeatherServiceDataService(): any;\r\nexport declare function checkWeatherServiceStatus(): any;\r\nexport declare function getForecastStalenessService(): any[];\r\nexport declare function getAlertsByStateService(): any[];\r\n"}}
